[
["index.html", "Geog-364: Introduction to R Chapter 1 Lab 1 1.1 Introduction 1.2 Installing R and R-studio 1.3 Getting started 1.4 Lab challenge 1 1.5 R coding basics 1.6 Lab Challenge 2 1.7 Create a R-Markdown document 1.8 “Friendly text” 1.9 Lab Challenge 3 1.10 Online courses and resources", " Geog-364: Introduction to R Helen Greatrex 2020-09-16 Chapter 1 Lab 1 1.1 Introduction 1.1.1 Why is this class in R? There are many different types of software one can use to analyze spatial data. We’re going to focus on the R programming language because: It’s free and open source. It allows you to do traditional statistics, machine learning and data analysis. It’s a good introduction to programming, which is great for your resume. There are some very cool visualization tools including RMarkdown, Blogdown and Bookdown, where you can integrate R analysis into your papers, blogs and websites. For example, this lab book is written in Bookdown. RShiny for very cool interactive dashboards Leaflet and RGoogleMaps where you can use beautiful map making tools You will hopefully be exposed to all of these things throughout the course of the semester. 1.1.2 What are R and R-studio? R is a programming language commonly used by statisticians and scientists across the world. It can be used to analyse data, to visualise results and to develop new software. It is commonly used in spatial analysis because it is powerful and free, plus it allows you to combine spatial analysis with more traditional statistics. When I say R is a programming language, I mean that it is a collection of commands that you can type into the computer in order to analyse and visualise your data. Think of it literally like a language like Spanish or Hindi, so learning it means learning vocabulary and grammar to communicate with your computer. It also means it will get easier with experience and practice.. When you install R on your computer, you are essentially teaching the computer what those the language means along with some very basic Notepad-like software where you could enter the commands. Figure 1.1: The basic R screen More recently, R-studio has been designed as a piece of software to make it easier to programme in R. It’s what Microsoft Word is compared to notepad - lots more functionality and things to click. For example, you can easily see help files, run code, see your output and link to all the website/dashboard builders. In this course, we are going to use R-Studio as the main software, but you don’t need it if one day you only have access to R. Figure 1.2: The basic R-studio screen. Here is the R-Studio website where you can explore some of its features: https://rstudio.com/products/rstudio/features/ 1.1.3 What are R-Markdown &amp; R-Shiny? In recent years, people have developed new software in R to allow you to include your analysis in some pretty sophisticated outputs. RMarkdown is an document written in R, where you can combine code, results, equations and text (and photos/video etc). Essentially R-Markdown is a way to tell a story along with your data analysis, without having to copy and paste screen-shots of diagrams. This will be how you write up your lab reports. R-Markdown also goes beyond just interactive documents: RBookdown is a book written in RMarkdown. It is how I wrote this help document RBlogdown is a blog written in RMarkdown You can also make entire interactive websites in R-Markdown You can see examples and more details about R-markdown here: https://rmarkdown.rstudio.com/gallery.html RShiny allows you to make interactive applications and tools in R. Here are some examples: https://shiny.rstudio.com/gallery/ 1.2 Installing R and R-studio In this class, we would like you to download and install both R and R-Studio onto your own computers. If the labs are causing major problems with your computer or your computer hardware is struggling (or you have any other software issue), Talk to Dr Greatrex. We can definitely fix this and there are other options for “online R” that you can use. As these all have their own issues, getting it installed on your computer is likely easiest and the one I would like you to try first. In general, you can reach out to any of the teaching staff if you have any issue at all - we have likely see the errors hundreds of times before and we are happy to help. 1.2.1 I have R/R-studio installed already It’s great you have them installed! Many of the packages that we are using rely on the most up-to-date version of R and R-studio, so please update them to the latest version. To do this, follow these instructions: https://uvastatlab.github.io/phdplus/installR.html#updateR (If you know this will lead to issues on another project, talk to Dr Greatrex before you do anything). 1.2.2 Installing R/R-studio for the first time You need to install two new software programs, one called R and and called R-Shiny. You can click here for written instructions: https://psu.instructure.com/courses/2057289/pages/how-to-install-or-update-r-and-r-studio?module_item_id=30182767 Or follow these two installation tutorials in video format: To install R, follow this video: To install R-studio, follow this video: 1.3 Getting started 1.3.1 Open R-studio Figure 1.3: Icons of the R program and R-studio Open R-studio (NOT R!). You should be greeted by three panels: The interactive R console (entire left) Environment/History (tabbed in upper right) Files/Plots/Packages/Help/Viewer (tabbed in lower right) If you click on the View/Panes/Pane Layout menu item, you can move these around. I tend to like the console to be top left and scripts to be top right, with the plots and environment on the bottom - but this is totally personal choice. Figure 1.4: The basic R-studio screen when you log on If you wish to learn more about what these windows do, have a look at this resource, from the Pirates Guide to R: https://bookdown.org/ndphillips/YaRrr/the-four-rstudio-windows.html If you have used R before, you might see that there are variables and plots etc already loaded. It is always good to clear these before you start a new analysis. To do this, click the little broom symbol in your environment tab. 1.3.2 Change a few settings R-studio wants to be helpful and will try to re-load exactly where you were in a project when you log back in. This can get really confusing, so we are going to turn this off. ON A MAC: Click on the R-studio menu button on the top left of the screen, then click Preferences. ON A PC: Click on Tools-&gt; Global Options -&gt; Preferences Now: UNCLICK “Restore most recently opened project at startup” UNCLICK “Restore .RData into workspace at startup” Set “Save workspace to .RData on” exit to Never Figure 1.5: Change these 3 options, then press Apply and OK 1.3.3 Create an R-project We are going to use R-projects to store our lab data in. An R project is a place to store all your commands, data and output in the same place. R will know that it is all linked. This is useful because say you have Lab-2 open, but want to re-open Lab-1 to check some code, clicking the “Lab 1 project file” will load a whole new version of R with everything you did for Lab 1. It is really important that you stay organised in this course, for example making sure you know where you put your data and your labs. You will return to them in your final project, so it pays to be organised now. To encourage this, choose a place that makes sense on your computer, create a folder called GEOG364.You can either do this outside R studio in your file explorer, or inside the “Files tab” in R studio. You should store all your 364 files inside this folder Now we will create our first project (also see the pic): open R-Studio and click New Project, then click “new directory” then “new project”. Name your project Lab 1, then browse to your newly created GEOG364 folder and press open. Press OK and your project is created. Figure 1.6: Instructions to create an R project Your output should look something like this: Figure 1.7: Your screen after running the project Equally, R should now be “looking” inside your Lab 1 folder, making it easier to find your data and output your results. Try typing this into the console (INCLUDING THE PARANTHESES/BRACKETS) and see if it prints out the location of Lab 1. getwd() If you’re having issues at this point or haven’t managed to get to this step, STOP! Ask Dr Greatrex, Saumya or Harman for help. 1.4 Lab challenge 1 Now you have opened your project, take a screenshot of your R-studio page. It should look like Figure 1.7, e.g. with at least R version 4.0.2, with the Lab 1 project and the project stored in your GEOG-364 folder. To take a screenshot on a mac, press Command-3. The sreenshot will appear on your desktop To take a screenshot on a PC, press Alt + PrtScn Rename the screenshot to your “username_Lab1_Fig1”(for example for me it will be hlg5155_Lab1_Fig1), then place it in your Lab 1 sub-folder inside GEOG-364. This folder was created when you made the project You will need this later, so don’t skip this step. 1.5 R coding basics So now we FINALLY get to do some R-coding. 1.5.1 Basic arithmatic Remember that the aim of R is to type in commands to get R to analyse data. The console (see Figure 1.4) is a space where you can type in those commands and it will directly print out the answer. You’re essentially talking to the computer. The little “&gt;” symbol in the console means that the computer is waiting for your command. The simplest thing we could do in R is do arithmetic. Click on the console and try typing the following. Press enter and R will calculate the answer. 1 + 100 ## [1] 101 It should look something like this: Figure 1.8: Starting to enter commands in the console. I choose the sum 1+1 When using R as a calculator, the order of operations is the same as you would have learned back in school, so use brackets to force a different order. For example, try typing in each of the the commands below (in grey) 3 + 5 * 2 ## [1] 13 will give a different result to (3 + 5) * 2 ## [1] 16 Really small or large numbers get a scientific notation: 2/10000 ## [1] 2e-04 The e is shorthand for “multiplied by \\(10^{X}\\)”. So 2e-4 is shorthand for \\(2\\times10^{-4}\\) What if I press Enter too soon? If you type in an incomplete command, R will wait for you to complete it. For example, if you type 1 + and press enter, R will know that you need to complete the command So it will move onto the next line but the &gt; will have changed into a +, which means its waiting for you to complete the command. If you want to cancel a command you can simply hit the “Esc” key and R studio will reset. Pressing escape isn’t only useful for killing incomplete commands: you can also use it to tell R to stop running code (for example if it’s taking much longer than you expect), or to get rid of the code you’re currently writing. 1.5.2 Comparing things We can also do comparisons in R. Here we are asking R whether 1 is equal to 1. # note two equals signs is read as &quot;is equal to&quot; 1 == 1 ## [1] TRUE # inequality (read as &quot;is not equal to&quot;) 1 != 2 ## [1] TRUE # less than 3 &lt; 2 ## [1] FALSE # less than or equal to 1 &lt;= 1 ## [1] TRUE # greater than 1 &gt; 0 ## [1] TRUE # greater than or equal to 1 &gt;= -9 ## [1] TRUE 1.5.3 Variables and assignment It’s great to be able to do maths easily on the screen, but really we want to be able to save our results, or load in data tables etc, so we can do more complex commands. In R, we can give things a name. This is called a variable. So then, instead of typing the whole command, we can simply type its name and R will recall the answer. The way we store data into a variable is using the assignment arrow &lt;-, which is made up of the left arrow and a dash. You can also use the equals sign, but it can cause complications later on. Try typing this command into the console. x &lt;- 1/40 Notice that pressing enter did not print a value onto your screen as it did earlier. Instead, we stored it for later in something called a variable, with the name ‘x’. So our variable x is now associated with the value 0.025, or 1/40. You can print a variable on screen by typing its name, no quotes, or by using the print command. Try printing out your variable. You can do this in two ways, either by typing its name, or by using the print command. x ## [1] 0.025 print(x) ## [1] 0.025 Look for the Environment tab in one of the panes of RStudio, and you will see that ‘x’ and its value have appeared. This ‘x’ variable can be used in place of a number in any calculation that expects a number. Try typing log(x) ## [1] -3.688879 Notice also that variables can be reassigned: x &lt;- 100 print(x) ## [1] 100 x used to contain the value 0.025 and and now it has the value 100. Note, the letter x isn’t special in any way, it’s just a variable name. You can replace it with any word you like as long as it contains no spaces and doesn’t begin with a number. Different people use different conventions for long variable names, these include periods.between.words.1 underscores_between_words camelCaseToSeparateWords What you use is up to you, but be consistent. Combining variables You can now use multiple variables together in more complex commands. For example, try these commands: #Take the variable x, add 1 then save it to a new variable called y y &lt;- x + 1 # print the multiple of 2yx onto the screen y ## [1] 101 Now you can see that there are two variables in your environment tab, x and y. Where y is the sum of the contents of x plus 1. **The way R works is that first it looks for the commands on the right of the arrow. It runs all of them, calculates the result, then saves that result with the name on the left of the arrow. The right hand side of the assignment (right of the &lt;-) can be any valid R command. The right hand side is fully evaluated before any assignment occurs.The variable only saves the result, not the command itself. You can even use this to change your original variable . Try typing the code below in a few times into the console and see what happens. A short cut to do this is to type the commands the first time, then use the up-arrow on your keyboard to cycle back through previous commands you have typed x &lt;- x + 1 #notice how RStudio updates its description of x on the top right tab x # print the contents of &quot;x&quot; onto the screen ## [1] 101 Our variables don’t have to be numbers. They could refer to tables of data, or a spatial map, or any other complex things. We will cover this more in future labs. 1.5.4 Functions The power of R lies in its many thousands of built in commands, or functions. In fact, we have already come across one - the print command. Some more examples include: plot(x=1:10,y=1:10) This will plot the numbers 1 to 10 against 1 to 10 x &lt;- nchar(\"hello\") This will count the number of letters in the word “hello” (e.g. 5), then save it as a variable called x Watch this short video to learn three important facts about functions: The file.choose() command will let you interactively select a file and print the address out onto the screen. Try each of these out in your console for the file.choose() command: # Typing this into the console will print out the underlying code file.choose # Typing it WITH parentheses will run the command file.choose() # Typing a ? in front will open the help file for that command ?file.choose The round brackets/parentheses after the name ( ), mean that it is a command. Sometimes we need to give the command some additional information. Anything we wish to tell the command should be included inside the inside the parentheses (separated by commas). The command will literally only know about the stuff inside the parentheses. sin(1) # trigonometry functions. Apply the sine function to the number 1. ## [1] 0.841471 log(10) # natural logarithm. Take the natural logarithm of the number 10. ## [1] 2.302585 This following command will plot the number 1 to 10 against the numbers 12 to 20, along with some axis labels. When you run this, the plot will show up in the plots tab. plot(1:10,11:20,col=&quot;dark blue&quot;, xlab=&quot;x values&quot;,ylab=&quot;GEOG-364 is the best&quot;) # plot the numbers 1 to 10 against the numbers 11 to 20 1.5.4.1 Command help As mentioned above, typing a ? before the name of a command or function will open the help page for that command in the “environment” box on your screen. As well as providing a detailed description of the command and how it works, scrolling to the bottom of the help page will usually show a worked example of the code which you can copy into the console. You can then copy these line by line into the console to understand what is happening. ## This provides the help page for file.choose. ?file.choose Figure 1.9: What you should see after typing ?file.choose 1.5.5 Packages There are now several million commands/functions available for you to use in R. To make sure your computer doesn’t get overwhelmed, it doesn’t load all of these at once. In fact many need to be downloaded from the internet. A close analogy is your phone. There are several million things you can do on your phone, which are collated into bundles called apps. To use the features in an app, you need to click on the icon of the app to load it. Equally you need to download many apps from the internet to start with. So we have R: The programming language itself Functions: Which are specific commands or actions written in the R language Packages: Commands are grouped into bundles called packages, which we need to load every time. This mini video and tutorial also explains things clearly. Click on the link, work thorugh it and we will install our own packages in the next lab. 1.5.6 Coding help Don’t worry about trying to remember every function in R. In this course, you will be provided with most of the functions you need, but you can also simply look up what you need on Google. This cartoon from XKCD is a pretty normal way to think about programming! One of the most important skills you can learn as a programmer is how to effectively google the information you need… Figure 1.10: https://xkcd.com/627/ 1.6 Lab Challenge 2 Now we are going to download some packages from the internet and install them. You must be connected to the internet to make this happen! In the console, type the following commands, or click the “Install” button in the packages tab (next to plots) and find the package name. If it asks if you want to install dependencies, say yes. install.packages(&quot;knitr&quot;) install.packages(&quot;rmarkdown&quot;) install.packages(&quot;tidyverse&quot;) You will see a load of red text appear in the console as it tells you its very detailed status of how it’s downloading and installing. Don’t panic! It might also take several minutes to do this, longer on a bad internet connection. When you have typed all three commands and waited until they have finished running (remember, when it is done, you should see the little “&gt;” symbol in the console waiting for your next command), we want to check if they have installed successfully onto your computer. To do this we are going to load them using the library command: library(&quot;knitr&quot;) library(&quot;rmarkdown&quot;) library(&quot;tidyverse&quot;) If you have managed to install them successfully, often nothing happens - this is great! It means it loaded the package without errors. Sometimes, it will tell you friendly messages. For example, this is what shows up when you install the tidyverse package. It is telling you the sub-packages that it downloaded and also that some commands, like filter - now have a different meaning. E.g. originally the filter command did one thing, but now the tidyverse package has made filter do something else. Figure 1.11: Tidyverse install messages To find out if what you are seeing is a friendly message or an error, run the command again. If you run it a second time, then nothing should happen. ! IMPORTANT If you see some red errors here after mulitple attempts running the commands, we will have to fix what your computer is doing together. If you see errors, then take a screenshot of the full page and talk to a TA or Dr Greatrex, or post on piazza under the Lab 1 tab. 1.7 Create a R-Markdown document 1.7.1 What is markdown? So far, we’ve been typing commands into the console, but these will all be lost once you close R. Equally, it’s hard to remember or reproduce the analysis you have done . So we will now move onto writing code commands that you can save and submit. There are several types of document that you can create and save in R-Studio. A basic script (the filetype is .r). This is simply just a blank document where you can save code commands (a script is shown in (Figure 1.1)). When you “run” the commands in the script, R simply copy/pastes the commands over to the console. An R-Notebook or Markdown document (the filetype is .Rmd). These are documents you can use to write a report with normal text/pictures, but and also include both your R code and output. You can turn these into reports, websites, blogs, presentations or applications. For example these instructions are created using a markdown document. In this course we are going to focus on the R-Notebook format. Watch this 1 min video covers markdown files and leads to a comprehensive guide on how to create them. Markdown and Notebook files are almost identical, so I will use the terms interchangeably for now. 1.7.2 Creating a notebook document Time to make your own. Go to the File menu on the top left, then click New File - Notebook. A file should appear on your screen - your first notebook script. Essentially, we have some space for text, some space for code, and a space at the top of the file where we can add information about themes/styles etc. Figure 1.12: You should see TWO new files appear in your lab 1 folder If you click on the little right triangle arrow at the top-right of the code chunk, you can run the plot command, and a picture will appear, running the code. Note, it no longer runs in the console. You can still copy things into the console, by clicking on the line you want to run and pressing Ctrl-Enter / command-Enter. Let’s try this. On line 11, delete plot(cars) and type 1+1. Now press the green arrow and the answer should appear directly under your code chunk. Now click at the end of the script, around line 20 and press the green insert button (top right in the script menu icons). Insert a new R code chunk. Inside, type 1+2 and run it. So you can see that you can have text/pictures/videos etc, and code chunks interspersed throughout it. Finally, click on the script then press the save button. Save it as GEOG364_Lab1_PSU.ID e.g. GEOG364_Lab1_hlg5155 You will see two files appear in your files tab, and your Lab_1 folder. Click on the LabScript1_abc9999.nb.html file then it will open in your file browser - you should see your code output and your formatted text. You have made your first R-html output - congrats! IMPORTANTLY - If you don’t “run” each code chunk by clicking the arrow, or clicking the run-all button in the top right, then that code won’t run in your final html output that we grade. If that is the case we can’t see if the code works and cannot award you the marks! SO - get in the habit of pressing “run-all” before you submit your final html file Figure 1.13: You should see TWO new files appear in your lab 1 folder 1.7.3 Text formatting (in the white area) If you want to make bold/italic/underline text formatting, or to create section headings in your text, you need a few more commands. Remember, this is for the text in your final report in the white area - only R commands go in each code chunk! You need to press enter twice to start a new paragraph. As another example, if you type *TEXT*, you will see TEXT On a new line if you type # this is a new section header, then R will interpret that as a new chapter or section header and change the font accordingly. Here is what this text looks like in my script: Figure 1.14: My writing The easiest way to learn these is to click the Help/Markdown Quick Reference Menu, which will bring up a cheat-sheet with all the formatting. Although this feels like a pain, it’s actually useful because it makes it very easy for R to change the formatting depending on what output format you need. Figure 1.15: Bringing up the formatting cheatsheet THERE IS ALSO A SPELL-CHECKER NEXT TO THE SAVE BUTTON - REMEMBER TO USE IT! 1.8 “Friendly text” Much of what you see on your screen when you open a notebook document is simply a friendly introduction to RStudio. So your notebook file is essentially a Word document with the ability to add in “mini R-consoles”, AKA your code chunks. Imagine every time you opened a new word document, it included some “friendly text” (“hi, this is a word document, this is how you do bold text, this is how you save”). This is great the first time you ever use Word, but kind of a pain after that. RStudio actually does this. Every time you open a notebook file, you actually do get this friendly text, explaining how to use a notebook file. Read it, make sure you understand what it is telling you, then delete all of it. So delete from line 6 to the end. The stuff left over is your YAML code which tells R how to create the final html file. DON’T TOUCH THAT. Figure 1.16: You should see TWO new files appear in your lab 1 folder 1.9 Lab Challenge 3 Your final challenge. Delete all the “friendly text” in your script - you should be just left with your YAML code and a blank file (see previous section) Create a new level-1 section header called “R-Basics”, then press enter a few times (or your header will not work). See the formatting help if you are not sure how. Figure 1.17: Remember to add a blank line BEFORE AND AFTER your headings Now in the space below your header, add an interesting fact or something you learned about R. Write part of your fact in bold text. Below the text, add a code chunk and include some code of your choice that runs without an error. AT A MINIMUM, YOUR CODE CHUNK SHOULD INCLUDE Applying a function to your data Assigning the result to a variable Using the print command to print that variable out A common question is “but what code should I write?”. Surprise us! If you’re really new to all of this, you could choose something very similar to the simple exercises above, or if you are more experienced, you could stretch yourself with something more fun and complex (last year, someone made a llama plot..). The thing we are testing is that you understand how to create a code chunk and some basic code features. Below that code chunk, create a new heading called “Project Location” Remember the screenshot you took in Lab challenge 1? We are going to add it in here. First, lets find the file. It should be easy as you should have put it in your Lab 1 folder. R doesn’t automatically know which folder to look in, so that file.choose() command can help us find it. IN THE CONSOLE, type file.choose() (including the empty parentheses). A window will pop up. Find your screenshot then press OK. You will see in the console the file address has been written down. Now, go back to your script. Create a new code chunk and inside type the following, but replace FILEADDRESS with the full address that just appeared on your console (INCLUDING THE QUOTES). Now click run and the chunk should load your screenshot inside your R-script. As described in Lab challenge 1, we are checking the version of R, that you have created the project and stored it in the right place. # Load the knitr library library(knitr) #Add your screenshot knitr::include_graphics(&quot;FILEADDRESS&quot;) Figure 1.18: How your code should look but with your own picture and address Pictures are a little weird in R, which is why we’re taking our time with this lab. If your picture does not show up in the final nb.html: Did you run the code chunk in the R-script so that it showed up just below the code chunk? (not in the plots tab) If not, run the code chunk then save again You can “knit” the file by clicking knit (near the save button), which will create a html rather than a nb.html. This should include the picture. You are 100% fine to submit the html instead of the nb.html If it STILL doesn’t work, click in the text oart (outside the code chunk), create a new line and try the command ![](FILEADDRESS), where FILEADDRESS is the output of file.choose() in the console CLICK RUN-ALL, then save your file. Go to your Lab 1 folder and click on the nb.html file. This should now be a professional html file of your work. If you have issues, try pressing the knit button and look at the html file (either are fine to submit) Go to Canvas, complete the Canvas course and submit. Congratulations on making it through a long document. The first time in a new programming language is always tough, so nice work for making it this far. 1.10 Online courses and resources If you want to practice the basics,then there are several places you can take free introductory tutorials - all of which I recommend. These include: https://bookdown.org/ndphillips/YaRrr/ The Pirate’s Guide to R. FREE linkedin learning for R (Penn State log-in required): https://www.linkedin.com/learning/learning-r-2/r-for-data-science?u=76811570 FREE (basic account) code academy - https://www.codecademy.com/courses/learn-r/lessons/introduction-to-r/ Data Camp: First chapter is free - https://www.datacamp.com/courses/free-introduction-to-r If you’re completely lost - it’s OK! This is pretty normal at this stage. Talk to the instructors and we can point you in the direction of resources to make you feel more comfortable using R. "],
["lab-2.html", "Chapter 2 Lab 2 2.1 Learning objectives 2.2 Lab set-up 2.3 Data.frames and summary statistics 2.4 Converting to spatial data 2.5 Assigning a map projection 2.6 Interactive Leaflet plots 2.7 Describe the Ghana data 2.8 Show me something new 2.9 Lab submission check", " Chapter 2 Lab 2 2.1 Learning objectives The aim of this lab is to start you out exploring spatial data and to do some basic analysis. By the end of this lab, you should be able to: Read-in and summarise table/spreadsheet data (data.frames) Select subsets of a data.frame using square brackets and the $ sign Plot specific columns of a data.frame against each other (E.g. long/lat) Understand the main types of spatial data format in R Be able to convert your data to either sp or sf format Load regional and country borders using rnaturalearth Plot sp data using the base package and interactively using Leaflet Critically analyse rain-gauge locations in R. Add a theme, authorship and table of contents to your markdown files. 2.2 Lab set-up 2.2.1 Create a Lab 2 Project R Projects are useful because you can easily keep your labs and future projects separate, without losing your code and data. For example,if you want to go back to an old Lab (say Lab 1), you can simply go into the Lab folder and click Lab1.RProj - this will open R and all your old code so you can carry on where you left off. So, to keep things tidy on your computer, lets create a new R-Project. First, make a new project called Lab 2 inside your GEOG364 folder. Hint: Go to the main menu-bar at the very top of the screen, then click: File | New Project | New Directory | New Project. Then call the project Lab 2 and make sure it’s created as a sub-directory of your GEOG-364 folder. Or follow the instructions in Section 1.3.3. Now, go to the File menu/New File/R Notebook to create a new blank lab script. Delete the “friendly text” - see section 1.8 and save it as GEOG364_Lab2_PSU.ID.Rmd e.g. GEOG364_Lab2_hlg5155.Rmd You should see something like the figure below, If you type getwd() into the console, it should return the location of the Lab 2 folder on your computer. Figure 2.1: What your screen should look like, but the address of getwd() should be the one on your computer. Note that pressing save on the script has automatically made your .nb.html file 2.2.2 Markdown adding a theme While your lab script is blank, lets focus on the YAML code at the top (lines 1-4). This makes your html output and there are many ways to customise it. Your YAML code currently looks like this --- title: &quot;R Notebook&quot; output: html_notebook --- Change the YAML code to look like this (but with your name). Note, if you copy/paste this and it doesn’t work, sometimes the quote marks copy weirdly from the internet - try deleting and retyping the quotes. --- title: &quot;Geog-364: Lab 2&quot; author: &quot;Helen Greatrex&quot; date: &quot;`r Sys.Date()`&quot; output: html_notebook: toc: true toc_float: yes number_sections: true theme: lumen --- The elements we just added are: The title The author Today’s date A floating table of contents and numbered sections (this won’t appear until you start typing section headings) The document is now in the lumen theme Now, save your file, or click “preview” at the top of the script. See if it works. If you click the knit button to make a html rather than a nb.html, then you will need to add a few extra lines for both output formats. So yours should look something like this. Figure 2.2: Where the point &amp; click package install button is There is a reasonable chance this won’t work first time around, as editing the YAML code can be a pain. It is very case and space sensitive. For example, the spaces at the start of some lines are important and are created using the TAB KEY, not the space bar. There is one TAB key before html_notebook (which is now on a new line). There are two TAB KEYS before toc, toc_float, number_sections and theme Don’t continue until you can make and view your html or nb.html file. If it doesn’t work, ask for help before moving on Challenge You can view themes for markdown documents here. https://www.datadreaming.org/post/r-markdown-theme-gallery/ Choose one that works for you and edit your YAML code to load it. 2.2.3 Installing common spatial packages Here, we are going to install some of the most common spatial analysis packages: rgdal, raster, sp, sf,leaflet,tmap and rnaturalearth. This can take some time, so I suggest getting the download running, then returning here to continue reading through the lab notes. As discussed in the previous lab, you can install these packages EITHER by [1] Copy/Pasting this command into the CONSOLE (if you put it in a code chunk, it will download and install every single time you run your script, which we don’t need): install.packages(c(&quot;rgdal&quot;, &quot;raster&quot;, &quot;sp&quot;,&quot;sf&quot;,&quot;rnaturalearth&quot;, &quot;leaflet&quot;,&quot;tmap&quot;,&quot;remotes&quot;)) remotes::install_github(&quot;AndySouth/rnaturalearthhires&quot;) OR [2] Going to the Packages menu (next to plots), clicking install, then choosing each package one by one (make sure install dependencies is clicked). Figure 2.3: Where the point &amp; click package install button is Once the packages have finished downloading and you can see the &gt; symbol again in the console, you can move on. In your script, make a new R-code chunk, Copy this code inside and run it. library(rgdal) library(sf) library(raster) library(knitr) library(sp) library(raster) library(leaflet) library(tmap) library(rnaturalearth) You should see similar messages to ones that come up here. Figure 2.4: Common friendly messages If instead of this, you see loads of red error code: Re-run the code chunk. Sometimes that clears it up Check you have spelt everything correctly Try to re-install the package, then re-run the code chunk If you are still seeing errors, ask for help. 2.2.4 Download data for this lab Now you need to download some data from Dr Greatrex’s github repository: A table of weather station locations in Ghana. Copy/Paste this code either into the console to download the files. ## Note, the structure of an R command. We have a function (a command), download.file(). ## R knows it is a function because it has parentheses after it. ## Inside the parentheses are the arguments that R needs to carry out the command ## (e.g. the address and the filename), separated by commas filelocation &lt;- &quot;https://raw.githubusercontent.com/hgreatrex/GEOG364_Labs/master/Lab_2/Lab02_GhanaMetStations.csv&quot; download.file(filelocation, destfile = &quot;Lab02_GhanaMetStations.csv&quot; , verbose=TRUE) The file should appear in your Lab 2 folder. If not, you probably didn’t create the project above, or your getwd() didn’t show your Lab 2 folder. 2.3 Data.frames and summary statistics 2.3.1 Reading in your first file In your script, make a new Section heading called “Data Input”. If you can’t remember how to do this, see Section 1.7.3, or pull up the Markdown Quick Reference Guide (see the Figure below) Figure 2.5: The incredibly useful Markdown quick reference The data you just downloaded, Lab02_GhanaMetStations.csv is essentially a basic spreadsheet called a .csv file (each number is separated by a comma). You can open this in Excel or notepad to have a look, but don’t save it there. First, we need to load, or read, this file into R. To do this, create a new code chunk and copy this code into it, including comments. # The read.csv command reads in a csv table of data into R. # We then save the table as a variable called Stations. Stations &lt;- read.csv(&quot;./Lab02_GhanaMetStations.csv&quot;,as.is=TRUE) If it doesn’t work, double check that the file actually is in your Lab 2 folder. If it does work, you should see that “Stations” has turned up in your environment area on your screen, probably on the top right. If you click on its name, you can have a look at the table, which can be a useful cross check to make sure that it all read into R successfully. Or, if you prefer you can print it into the console or into a code chunk, by typing its name into the console. In R, this type of data (a table) is called a data.frame. Figure 2.6: First look at the Stations data 2.3.2 Summarising data There are several functions that you can use to summarise data, especially data in a table. These include: str(TABLENAME) summary(TABLENAME) Where TABLENAME is the name of the data.frame variable you wish to explore. Challenge Create a code chunk and apply the functions above to Stations. Then in the text below the code chunk, use the results of your code to answer these questions: How many rows of data does the table have? What is the average Longitude of the stations? 2.3.3 Selecting columns and rows Sometimes, we do not want to analyse at the entire data.frame. Instead, we would like to only look at one (or more) columns or rows. There are several ways we can select data. The first is we can use the $ symbol to select its name. For example, to select the Latitude column, you can use the command # COLUMN NAMES ARE CASE SENSITIVE Stations$Latitude Secondly, we can use square brackets to numerically choose a column. This follows the format: TABLENAME[ROWS,COLUMNS] # This will select the 5th row and 7th column Stations[5,7] # This will select the 2nd row and ALL the columns Stations[2,] # This will select the 3rd column and ALL the rows Stations[,3] # We can combine our commands, this will print the 13th row of the Longitude column # (no comma as we&#39;re only looking at one column) Stations$Longitude[13] # The : symbol lets you choose a sequence of numbers e.g. 1:5 is 1 2 3 4 5 # So this prints out rows 11 to 15 Stations[11:15,] # The &quot;c&quot; command allows you to enter whatever numbers you like. # So this will print out rows 4,3,7 and all the columns Stations[c(4,3,7),] Challenge In a new code chunk, write and run the code to: Select Rows:4,6,2 and Columns:1 and 2 , then assign it to a variable called subset. Print values/rows 45:50 of the Station.Name column (you will just see 5 names as the answer) Apply the median() function to the Latitude column and print the output. E.g. what is the MEDIAN latitude in the Stations dataset? There is one Station.Name that has been duplicated (a common issue). Apply the table() function to the appropriate column to work out which station it is. Write the name of the station as a COMMENT inside the code chunk below your line of code. 2.3.4 Basic plot We can now make a basic plot of our data. Here we can use the plot command along with our new found knowledge to select columns. plot(Stations$Longitude,Stations$Latitude) This gives us the basics but it could be made more professional. Type ?par into the console, or search for par in help, and R will display a load of arguments that can improve the plot. For example, here, I have changed the asp (aspect ratio), pch (point shape) and col (point color) arguments. plot(Stations$Longitude,Stations$Latitude, pch=16, col=&quot;blue&quot;) Challenge Make a new code chunk and make a plot of the station locations. Your plot should include: Red points An aspect ratio of 1 (asp argument) Better x and y labels (xlab and ylab arguments) A point size of 0.5 (cex arguments) Although this plot is OK, it’s not great. The next section shows how to improve using the specific spatial packages available in R. 2.4 Converting to spatial data R is not clever. It’s a bit like working with a toddler. We might know that the words Longitude and Latitude have special spatial meaning for our Stations table, but R is not intelligent enough to work this out. So, several dedicated packages have been developed in R specifically for spatial data. There are four “mainstream” packages dedicated to dealing with both vector and raster spatial data: sp sf raster terra (not covered in this course but likely the future) Many package authors will write their commands assuming that your data is in a specific spatial format (e.g. sp). So understanding how to read in data into different formats is a useful skill. There are also some very specific packages which are slightly different. We will touch upon later in the semester, such as the ppp package for point pattern analysis, or ncdf4 for netcdf analysis. Others might link to google maps or ESRI products. 2.4.1 Making a data.frame “spatial” We are now going to focus on two very similar packages, sp and sf. To convert a data.frame to a SF object, we use the st_as_sf command: #-------------------------------------------------------------------------- # To convert to sf format # Here, &quot;Longitude&quot; and &quot;Latitude&quot; should be the # EXACT CASE-SENSITIVE COLUMN NAMES of your x and y columns in your table. # There is nothing special about the words longitude and latitude here #-------------------------------------------------------------------------- Stations_sf &lt;- st_as_sf(Stations, coords = c(&quot;Longitude&quot;, &quot;Latitude&quot;)) Stations_sf ## Simple feature collection with 598 features and 1 field ## geometry type: POINT ## dimension: XY ## bbox: xmin: -3.033 ymin: 4.783 xmax: 1.65 ymax: 11.0833 ## CRS: NA ## First 10 features: ## Station.Name geometry ## 1 23007DI POINT (-1.95 4.783) ## 2 23007DIX POINT (-1.95 4.7833) ## 3 23005PRI POINT (-2.133 4.8) ## 4 23002SES POINT (-1.917 4.85) ## 5 23001AXM POINT (-2.2333 4.8667) ## 6 23001AM POINT (-2.233 4.867) ## 7 23004AGO POINT (-1.967 4.883) ## 8 23005TAK POINT (-1.766 4.89) ## 9 23003TDI POINT (-1.774 4.894) ## 10 18025ABR POINT (-2.05 4.9) To convert a data.frame to a SP object (a spatialpointsdataframe), we simply tell it what the coordinates are: #-------------------------------------------------------------------------- # Or convert the original table to sp format #-------------------------------------------------------------------------- coordinates(Stations) &lt;- c(&quot;Longitude&quot;,&quot;Latitude&quot;) # Print out the result. You can see that R now sees it as a &quot;Spatial Points Data.frame&quot; Stations ## class : SpatialPointsDataFrame ## features : 598 ## extent : -3.033, 1.65, 4.783, 11.0833 (xmin, xmax, ymin, ymax) ## crs : NA ## variables : 1 ## names : Station.Name ## min values : 01000BAB ## max values : 23098ACC Let’s talk about the new information R is providing. We have class: You can have a spatial points dataframe, a spatial lines dataframe, or a spatial polygons dataframe. So you can see what type of vector data you have features: How many points are there (equivalent to the number of rows) extent: What is the furthest North/South/East/West that the data extends crs: The map projection. See the next section variables How many attributes of the data do we have? We just have one, Station.Name names: The names of your attributes (the other things you can plot) min values and max values Some information about the attributes, in our case the first and last station. You might find that you run the coordinates command once without error, but the second time around you see something like this: Figure 2.7: A common error This is because the coordinates command changes a TABLE into spatial data. But if you run it again, you are trying to convert spatial data into more spatial data and R gets confused. So you can completely ignore this error - it means everything is working fine. Challenge Make a new heading called “Spatial Analysis” Underneath that, create a new code chunk and use the code above to convert your Stations data to sp format. In the console, type plot(Stations). Your plot should now look very different. Above the code chunk, in the white text, explain what you just did. Figure 2.8: Plotting the data now it is sp format 2.4.2 Reading in vector line data (rnaturalearth) Let’s now also include some vector-line data on top of our points, but adding in some regional administrative boundaries. In later labs, we will learn how to read in vector data from a file, but this time we are going to use data that is already built into R. This is part of the rnaturalearth package, which links automatically with the “Natural Earth” dataset, found here: https://www.naturalearthdata.com/features/ For administrative border data, we can use the ne_countries or the ne_statescommands. For example, this would load the entire world borders and assign it to a variable called worldborder. # You can choose if you want the output to be sf or sp data worldborder &lt;- ne_countries(scale = &quot;medium&quot;, returnclass = &quot;sp&quot;) plot(worldborder) and this would load the regional boarders for the United Kingdom # You can choose if you want the output to be sf or sp data UK &lt;- ne_states(country=&quot;united kingdom&quot;,returnclass = &quot;sp&quot;) plot(UK) Challenge In your script, make a new section heading called “Vector data”. Now make a new code chunk and use the ne_states command to load regional borders for Ghana. Assign it to a variable called ghana. Above the code chunk, in the white text, explain what you just did. 2.5 Assigning a map projection Map projections and coordinate system are an essential part of spatial statistics. Also, say we want to overlay country boarders on our points. In that case, the coordinate systems of the shapefiles need to be identical. R makes use of the PROJ4 library which is a set of character strings that defines a coordinate system (a datum and/or map projection definition). The PROJ4 character string syntax consists of a list of parameters, each prefixed with the + character. For example, the familiar UTM grid system is defined by +proj=utm the specific zone number (e.g., 19) is defined by +zone=19 and the datum (e.g., NAD 1983) is defined by +datum=NAD83 Putting these parameters together, we would see something like this: \"+proj=utm +zone=19 +datum=NAD83 +no_defs +ellps=GRS80 +togrs80\" A list of a the PROJ4 map projection names and their parameters used in defining a coordinate system can be found here: https://proj.org/operations/projections/index.html. We will also discuss this in more detail in later labs. If you are interested in projections, for a comprehensive guide, use this resource: https://bookdown.org/robinlovelace/geocompr/reproj-geo-data.html 2.5.1 Checking a projection in the sp package In most cases, dealing with spatial data will involve changing the datum definition, map projection, or one of the map projection parameters (such as the central meridian or standard parallels). You can check the existing projection using the projection command: ## Here SPATIALDATA is the name of the object you want to examine projection(SPATIALDATA) Challenge In a new code chunk, print out the projection of Stations and also the projection of ghana. You should see that one is “NA” and one is a common long-lat projection: \"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\". Above the code chunk, in the white text, explain what you just did. This can causes problems! If our map projections are different for different datasets, then they will not align with each other in any plots or analysis. So lets change the projection of Stations. 2.5.2 Assign/changing projections in the sp package To change a projection: IF THE PROJECTION IS NA: To set the first ever coordinate system for an sp object, you would use the the CRS command # Nothing should happen when you run the code chunk if there&#39;s no error # Here SPATIALDATA is the name of the object you want to assign a projection to # proj4string(SPATIALDATA) &lt;- CRS(&quot;your projection code&quot;) #e.g. to change the projection of Stations to UTM, the code would be as follows proj4string(Stations) &lt;- CRS(&quot;+proj=utm +zone=19 +datum=NAD83 +no_defs +ellps=GRS80 +togrs80&quot;) # THIS WILL NOT WORK IF YOUR DATA ALREADY HAS A PROJECTION If your data ALREADY HAS A PROJECTION: you can change it using the spTransform command # Nothing should happen when you run the code chunk if there&#39;s no error # Here SPATIALDATA is the name of the object you want to assign a projection to Stations &lt;- spTransform(Stations,&quot;+proj=longlat +datum=WGS84&quot;) This also means that if you re-run your chunk you might get a warning or an error. Because you set the original projection once using CRS, but a quirk of R means it will show an error if you try to set the projection of something that already has one assigned. So again, if you are running twice and see an error you can ignore it. Challenge In a new code chunk, assign the projection of your Stations data to be this CRS: \"+proj=longlat +datum=WGS84\" 2.5.3 Map projections in the sf package The same kind of transformations can also take place in sf formats. Unlike with RGDAL, you would use sf_transform() for sf formatted data. 2.6 Interactive Leaflet plots Let’s now see how our data looks plotted. Create a new sub-heading called “Data Plots”, then in a new code chunk enter the following code. You should see a basic plot that looks like this. If so, congrats! If not, you need to adjust your projections or something has happened. plot(Stations) plot(ghana,add=TRUE) The plot above is still pretty basic, so lets explore some of the big packages available to let you make “pretty plots” of spatial data. There are three big mapping functions in R: ggmap, tmap and leaflet. Today, we are going to make some interactive maps using Leaflet - an interactive mapping tool that goes far beyond R. Watch the video to get a sense of it. To make our first Leaflet plot, we will ignore the %&gt;% symbol you saw in the video. Essentially we make a leaflet map by adding layers. At the end, we print the map by typing its name. # leaflet makes maps in layers and only at the end, prints out the final map #LAYER1 mymap &lt;- leaflet(data = Stations) #LAYER2 mymap &lt;- addProviderTiles(mymap, providers$Stamen.Toner) #LAYER3 mymap &lt;- addCircleMarkers(mymap, label = ~as.character(Station.Name), radius=.3,opacity = 0.8) # R doesn&#39;t care if one command is on 2 lines.. #LAYER4 mymap &lt;- addPolygons(mymap, data=ghana,weight=2,col = &#39;red&#39;,fillOpacity = 0) #LAYER5 mymap In this case we have: LAYER 1: Load the Stations data into leaflet and assign it to a variable called mymap LAYER 2: Use addProviderTiles to add a custom map background onto mymap. You can find different examples here: http://leaflet-extras.github.io/leaflet-providers/preview/index.html LAYER 3: Add custom markers to mymap, each one labeled with the Station.Name (taken from the Station.Name column of the data.frame) LAYER 4: Add the country borders from the ghana data. These are actually polygons, so make sure the fillOpacity is 0 to only show the border. LAYER 4: Print the final map Challenge Copy the code above into your own code chunk. Then change the map background to be something more informative (your choice). 2.7 Describe the Ghana data Even though we are going to learn some advanced spatial techniques in GEOG-364, one of the most important ways to analyse spatial data is to look at it and explore its features. We often want to map rainfall across the world. Because rainfall is a field (there is a value everywhere), it would initially make sense to spread your rain-gauges out in a uniform grid. Yet, in Ghana at least, this is not what is happening. Examine the Ghana rain-gauge data in your leaflet plot. Try different map backgrounds (terrain, land-use, others..). Try to understand why the data is spatially distributed the way it is. Now in your text, explain: What type of data are we looking at? What map projection does it have? You describe the spatial structure of the data and any key features that it has You describe why you think the data looks this way spatially. Provide evidence for your answers (you can have multiple plots if you want) What features in the data would concern you if you were a data scientist? Can you see any likely errors? 2.8 Show me something new This section is going to be a feature of all of your labs in GEOG-364 and likely in GEOG-464. It is designed to challenge you and push your R programming skills forward. One of the reasons an “A” is set at 90% is so that you can skip this section and still get an A, but I encourage you to try it as often as possible. Create a new section header called “Show me something new”. Beneath this, you need to show some new code or some new aspect of Markdown that goes beyond the lab. It doesn’t have to be long. You should also explain in your text or comments what the code does and what you are hoping to achieve. So you get used to the concept, in GEOG-364 I will always try to give some suggestions or inspiration. If you are struggling, you can show me some minor additions to existing code for 2.5/5 marks. For example: Copying code from earlier in the lab to plot the Station data, then changing the point type (pch) to crosses, or making the colors transparent Adding a new YAML element (you will have to do this at the top and describe what you did here) Showing me you know how to do some new markdown format (tables, links), https://rmarkdown.rstudio.com/lesson-6.html Something you think of - be creative! For full marks you need to demonstrates the use of a function or package that was not specifically covered in the handout, lecture, or lab. For example: Plotting the station data / borders using something like ggmap or tmap Loading the RColorBrewer data and using that for your plots Loading a rnaturalearth raster file and plotting that (bonus if it’s over Ghana and you can plot your points on top) Loading a relevant shapefile and plotting it over the Ghana data. Do something with a completely new package - this can be fun, like library(emojifont) Or your idea (welcomed) You will lose 2 marks for not explaining in the text what you are trying to achieve and what the commands are that do so. It should be clear you understand your code. 2.9 Lab submission check MARKDOWN/CODE STYLE - 5 MARKS Your code and document is neat and easy to read. You have section headings, have clearly labeled your answers or described what you are trying to do in the code. YAML - 10 marks You have adjusted your YAML code to include a theme, author, data and table of contents. This should show up in your final nb.html or html file R-BASICS - 30 marks You correctly answered all the questions in Section 2.6.2, 2.6.3 and 2.6.4. SPATIAL BASICS - 20 marks You checked the projections of Stations and ghana and adjusted the map projection of the Station data to be long/lat Section 2.10. You also plotted the ghana and Station data using the standard plot function and Leaflet (where you changed the theme) GHANA DESCRIPTION - 20 marks You included a thoughtful, well organized, and articulated response to the question about the Ghana gauges SOMETHING NEW - 5 marks You made a minor change to an existing piece of code (2.5/5) OR You demonstrated the use of a function or concept that was not specifically covered in the handout, lecture, or lab (5/5) HTML FILE SUBMISSION - 5 marks RMD CODE SUBMISSION - 5 marks [100 marks total] THERE IS NO CANVAS QUIZ WITH THIS LAB "],
["lab-3.html", "Chapter 3 Lab 3 3.1 Learning objectives 3.2 Lab 3 Set-Up 3.3 Initial Data exploration 3.4 Lab-3 Challenge 1 3.5 Mean Centre and Standard Ellipse 3.6 Lab-3 Challenge 2 3.7 Global Density analysis 3.8 Lab-3 Challenge 3 3.9 Local intensity - quadrat analysis 3.10 Lab-3 Challenge 4 3.11 Issues with quadrat analysis 3.12 Lab-3 Challenge 5 3.13 Kernel Density Estimation (KDE) 3.14 Lab-3 Challenge 6 3.15 Automatically calculating an “optimal” bandwidth 3.16 Lab-3 Challenge 7 3.17 Lab-3 Show me something new 3.18 Lab-3 submission check", " Chapter 3 Lab 3 3.1 Learning objectives Welcome to Lab 3, where we are going to focus on Point Pattern Analysis. A point pattern dataset events or objects occurring in a defined study region. These events could represent anything with a specific measurable location, from greenhouses to stars. Objective: The goal of Lab 3 is to learn some introductory spatial statistical approaches for characterizing first-order properties of a point pattern. We will be focusing on quadrat analysis, kernal analysis and standard ellipses. Data-sets: You will be working with two separate point pattern datasets that are already built into R. The first dataset, called longleaf pine, is a marked point pattern containing locations and diameter measurements of longleaf pint trees in a forest in Georgia. All your examples here in this lab book will analyse this dataset. The second dataset is called bei and is also related to trees. You will be analysing this one and will find out more as you go Figure 3.1: The two point datasets we are exploring 3.2 Lab 3 Set-Up 3.2.1 Create your Lab 3 project file Open a new version of R-studio. Click the file menu, then new project in a new directory. Select your 364 directory, then name the project Lab 3. If you are stuck on this process, see the start of Lab 1 and Lab 2. You can check this has worked by looking on the file explorer on your computer, then selecting your GEOG364 folder and checking that a Lab 3 folder has appeared with your Lab3.Proj file inside it. 3.2.2 Install new packages There are two specialist packages called “spatstat” and “car” which focus on point pattern analysis. 3.2.2.1 Install the spatstat package To make sure you do not include the install.packages command in your .Rmd file, please install it by clicking the “install button” in the packages menu. Click on the install button, then start typing spatstat,select it and press install. If you are a Windows user, you will see a message at the beginning of the install process saying that you need to install R-Tools. IGNORE THIS - You probably don’t need to install R-Tools Figure 3.2: You can click the button and simply type the name if the package you want to install The install might take a few minutes. Once it has finished, test it has worked by typing library(spatstat) into the console. you should see some messages like this. Figure 3.3: The messages that appear when I load spatstat for the first time There is a lot of text, but unless you have a load of things that say ERROR, you can ignore it. (Don’t worry about the out of date message). One way to check is to run the code chunk twice as shown in the screenshot. If the second time the messages disappear then you don’t need to worry. IF THIS PACKAGE HASN’T LOADED OR INSTALLED CORRECTLY, TALK TO AN INSTRUCTOR. 3.2.2.2 Install the car package Now, repeat the process for the car package. This might take a while to download. You should see something like this. Figure 3.4: The messages that appear when I load car for the first time IF THIS PACKAGE HASN’T LOADED OR INSTALLED CORRECTLY, TALK TO AN INSTRUCTOR. 3.2.3 Create your NoteBook file Now, go to File/New File and create a new R-NOTEBOOK file. Delete the friendly text (everything from line 6 onward) Save your file as GEOG364_Lab3_PSU.ID.Rmd e.g. GEOG364_Lab3_hlg5155.Rmd Follow Section 2.2.2 to modify your YAML code (you can keep lumen as a theme or try your own) Add a new code chunk. Inside add the following code and run it. library(spatstat) library(sp) library(car) The reason we are adding this just after typing it into your console is that these library commands need to be run every time you open R. So we put them in a code chunk right at the top of your Note Book file. Now click the Preview Button and make sure everything looks correct. IF THERE ARE PROBLEMS, TALK TO AN INSTRUCTOR 3.3 Initial Data exploration 3.3.1 Loading the data In this lab, we are going to use two datasets that are already built into the spatstat package. All of the examples in this lab book are based on a dataset called longleaf You will be conducting your analysis on a dataset called bei The advantage of this is that we don’t have to worry about file formats or Map Projections for now. But first, we need to load them into R studio Below your code chunk, make a new heading called Initial Data Analysis. Remember to leave a blank white line before and after your headings. If you can’t remember how to do this, go to Help/Markdown Quick Reference (where Help is the menu right at the top of your computer screen) or see Lab 1 or 2. Now make a new code chunk. Inside add: # This loads the internal dataset from R. data(longleaf) data(bei) Run the code chunk and you should see the longleaf and bei datasets appear in your environment quadrant on the screen (top right). From now onward, you do not have to run the longleaf examples because you can see the output in this lab script, but the data is there if you want to test examples. Your job is to understand the bei dataset. 3.3.2 Reading more information Because the longleaf and bei datasets are internal, they have their own help file. To view the help file for the longleaf data, I create a new code chunk, and run the command: # putting a ? at the start means look at the help file # this will only work for commands and data built into R. ?longleaf The help file now opens onto my screen: Figure 3.5: The longleaf help file We can see a lot of information from this file: My data is a point pattern dataset containing locations and diameter measurements of longleaf pint trees in a US forest in Georgia There are 586 pine trees in the dataset The data was collected and analysed by Platt, Evans and Rathbun in 1988 The data is marked. So it is not just locations, but it also contains additional information about the diameter of each tree trunk (in cm). The data is stored as a “ppp” object (which is a point pattern file type) The ppp object also contains information on the region (i.e., window) that was chosen for the study. In this case it is a rectangle with an X coordinate range of 0-200 and a Y coordinate range of 0-200, with units in meters. I then made an initial plot of the longleaf data. Because the data is marked, the size of the circle automatically corresponds to the marks, the diameter of the tree trunk. plot(longleaf) 3.4 Lab-3 Challenge 1 Make sure you have a code chunk that loads the packages using library, AND one that loads the data using the data commnd. If not, go back and reread the section. In a new code chunk, use the instructions above to load the help file for the bei data. Understand what the data is, how much data there is and whether it is marked. You are welcome to write notes here, but you will be assessed on your knowledge of this in the Canvas lab-3 quiz Q1 and Q2. Create a new code chunk and make a plot of the bei data. Comment underneath the plot about whether you see any spatial autocorrelation (positive/negative/zero), plus which spatial fallacies might cause problems in this lab. 3.5 Mean Centre and Standard Ellipse Firstly, let’s look at some summary statistics. The easiest thing to consider is the spatial mean, where we take the mean of all the x values vs all the y values. x.mean.longleaf &lt;- mean(longleaf$x) y.mean.longleaf &lt;- mean(longleaf$y) print(x.mean.longleaf) ## [1] 98.73527 print(y.mean.longleaf) ## [1] 113.8293 We can also add a standard ellipse using the dataEllipse command in the car package. dataEllipse(longleaf$x, longleaf$y, levels=0.68, fill=TRUE, fill.alpha=0.1, # Fill the ellipse with transparent grey pch=16, cex=.5, # filled small dots xlab=&quot;x (m)&quot;,ylab=&quot;y (m)&quot;, # labels col= c(rgb(red=0, green=0, blue=0, alpha = 0.5),&quot;blue&quot;)) # Slightly transparent points &amp; blue ellipse The reason this is often useful is that we can see if the overall distribution changes over time e.g. imagine repeating your survey of longleaf pines in 10yrs time and seeing if the distribution has changed with climate change or urbanization. 3.6 Lab-3 Challenge 2 Make a new heading called Standard Ellipse Make a new code chunk and find the spatial mean of the bei data Create a new code chunk and plot the standard ellipse of the bei data. This corresponds with questions 3 and 4 in the Canvas Lab 3 quiz. 3.7 Global Density analysis Let’s move beyond summary statistics. In the rest of this Lab, we will study the variation of the observations’ density across a study area, essentially giving us clues about the non-uniformity of space For example, the distribution of trees might vary across a landscape from North to South due to climate conditions, or show a more complex spatial pattern based on underlying soil characteristics. These underlying factors could easily result in some areas having dense clusters of trees and other areas causing clearings. This phenomenon is called First order spatial variation. AKA the underlying geography is causing the patterns we see (rather than a each individual point influencing the other points around it) Figure 3.6: plot from The first way to look at this is to examine the overall density of points over the entire field, known as the global intensity. This is simply the average number of points per grid-cell. We say it’s “global” because we only calculate one number for the entire study area. Mathematically, the overall intensity of a point process can be calculated via the following equation, where n is the number of points within our region and A is the area of the region. \\[\\lambda=\\frac{n}{A}\\] In R, we can do this simply by looking at the summary command. For the longleaf data, I am going to make a new code chunk and run summary(longleaf) ## Marked planar point pattern: 584 points ## Average intensity 0.0146 points per square metre ## ## Coordinates are given to 1 decimal place ## i.e. rounded to the nearest multiple of 0.1 metres ## ## marks are numeric, of type &#39;double&#39; ## Summary: ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 2.00 9.10 26.15 26.84 42.12 75.90 ## ## Window: rectangle = [0, 200] x [0, 200] metres ## Window area = 40000 square metres ## Unit of length: 1 metre Where we can see: That the global intensity of the pattern is 0.0146 trees per square metre (note the units). This also gives us a summary of some information from the help file It also summarizes our marks. We can see that the thinnest tree trunk has a diameter 2cm and the largest, 75.9cm. Finally it tells us the shape and area of our boundary box containing all our points is 200x200m. Note, this bounding box doesn’t have to be rectangular. 3.8 Lab-3 Challenge 3 Create a new subheading called global intensity Create a new code chunk and use the example above to work out the global intensity of trees in the bei dataset 3.9 Local intensity - quadrat analysis Instead of a single number for intensity, we can examine how the point density varies across the study area. The simplest way to do this is by a technique called quadrat analysis. To do this we will: Divide the region into a series of equally sized quadrats/rectangles Calculate the intensity of the point process in each quadrat, to see how it varies This can be done in R using the quadratcount command from the spatstat package. Q &lt;- quadratcount(longleaf, nx = 4, ny = 4) print(Q) ## x ## y [0,50) [50,100) [100,150) [150,200] ## [150,200] 34 49 25 36 ## [100,150) 34 48 78 46 ## [50,100) 43 26 37 47 ## [0,50) 33 18 15 15 The above command divides the longleaf dataset in 16 equally sized square grid-cells, or quadrats. I have specified 4 quadrats in the x direction and 4 in the y direction. It then returns a count of the number of points in each quadrat as well as the size of each quadrat. In this case we can see that the area is 50*50 = 2500m The above data is for counts, so we can either divide each value by 2500 or simply use the intensity command to print the intensity: # Print the density for each quadrat # This is literally the counts in each box divided by the area of each box, 2500m^2 intensity(Q) ## x ## y [0,50) [50,100) [100,150) [150,200] ## [150,200] 0.0136 0.0196 0.0100 0.0144 ## [100,150) 0.0136 0.0192 0.0312 0.0184 ## [50,100) 0.0172 0.0104 0.0148 0.0188 ## [0,50) 0.0132 0.0072 0.0060 0.0060 We can also plot this to make it easier to interpret: plot(longleaf, # I&#39;m plotting the longleaf data use.marks = F, # I didn&#39;t want it to plot the different circle sizes so i turned off marks cex = 0.5, pch = 4, # point size and shape main=&quot;Longleaf quadrat count&quot;) # plot title Q &lt;- quadratcount(longleaf, nx = 4, ny = 4) # Calculate the quadrat counts. plot(Q, add = TRUE, cex = 2) # Now I add Q on top. I can see the there are 15 points in the bottom right quadrat compared to 34 in the top left. In future labs, we will assess if this variation is statistically significant. Or we can also plot the intensity, because the colours make it simpler to see patterns. # Plot the intensity plot(intensity(Q, image=TRUE), main=&quot;Point intensity&quot;, las=1) # Plot intensity raster plot(longleaf, pch=20, cex=0.6, add=TRUE) # Add points Finally, I am going to calculate the Variance Mean Ratio, which gives an assessment about whether the data is clustered, uniform or random (AKA levels of spatial autocorrelation): # we use the as vector command to convert the data from a spatial ppp object back to a normal number longleaf.variance &lt;- var(as.vector(Q)) longleaf.mean &lt;- mean(as.vector(Q)) longleaf.VMR &lt;- longleaf.variance / longleaf.mean print(longleaf.VMR) ## [1] 6.918721 Overall, does this show the data is clustered or not? 3.10 Lab-3 Challenge 4 Create a new subheading called quadrat analysis Follow the example above, but replacing longleaf with bei - to create a quadrat analysis for the bei data. You should include: A table of counts A table of intensities A plot of counts A plot of intensities Calculate the Variance Mean Ratio for the bei data. You will need these to answer questions in the Lab 3 quiz. 3.11 Issues with quadrat analysis Quadrat analysis is susceptible to some major spatial fallacies and problems. As described in the mgimond e-text-book: “The choice of quadrat shape and size will influence the measure of local density and must be chosen with care. If very small quadrat sizes are used you risk having many quadrats with no points which may prove uninformative. If very large quadrat sizes are used, you risk missing subtle changes in spatial density distributions.” For example, changing the quadrat box size affects the strength of the north-west / south-east gradient we see here. Equally, there are clear clusters in the underlying data and analysis hasn’t really captured those at all. I want to explore the impact of changing quadrat size with the longleaf data. par(mfrow=c(row=1,col=3),mar=c(1,1,1,3)) # set up 3 subplots in a row # 2 x 2 gridcells Q.A &lt;- quadratcount(longleaf, nx = 2, ny = 2) # Split into 2x2 quadrats plot(intensity(Q.A, image=TRUE), main=&quot;&quot;, las=1) # Plot intensity raster plot(longleaf, pch=20, cex=0.6, col=rgb(0,0,0,.5), add=TRUE) # Add longleaf points plot(Q.A, add = TRUE, cex = 2,col=&quot;white&quot;,font=2) # Add numbers #### # 4 x 4 gridcells Q.B &lt;- quadratcount(longleaf, nx = 4, ny = 4) # Split into 4x4 quadrats plot(intensity(Q.B, image=TRUE), main=&quot;&quot;, las=1) # Plot intensity raster plot(longleaf, pch=20, cex=0.6, col=rgb(0,0,0,.5), add=TRUE ) # Add longleaf points plot(Q.B, add = TRUE, cex = 2,col=&quot;white&quot;,font=2) # Add numbers #### # 12 x 3 gridcells Q.C &lt;- quadratcount(longleaf, nx = 12, ny = 3) # Split into 12 x 3 quadrats plot(intensity(Q.C, image=TRUE), main=&quot;&quot;, las=1) # Plot intensity raster plot(longleaf, pch=20, cex=0.6, col=rgb(0,0,0,.5), add=TRUE) # Add longleaf points plot(Q.C, add = TRUE, cex = 1,col=&quot;white&quot;,font=2) # Add numbers One final important note for quadrat analysis, is that it is typically good to keep the numbers IN EACH QUADRAT to be at least 30. Otherwise you have an even higher likelihood of seeing patterns just by random chance. 3.12 Lab-3 Challenge 5 Create a new code chunk, then copy and paste the code above into it. Replace all the longleafs with bei (there are 6 instances) and run to check it works Now, modify the code chunk to: Make your subplots in 1 column but in 3 rows (e.g. arranged vertically) plot quadrat counts for 4 quadrats (2 in the x direction and 2 in the y direction), 20 quadrats (5 in the x direction and 4 in the y direction), 100 quadrats (10x10) Below the code chunk, write about the features you observe when modifying the number of quadrats for the bei data. This is a classic example of a spatial fallacy. Which one and why? 3.13 Kernel Density Estimation (KDE) Kernel Density Estimation is another method that we can use to explore point pattern densities. As described in https://sites.warnercnr.colostate.edu/wtinkham/courses-taught/nr-512-spatial-statistical-modeling/nr-512-exercise-descriptions/nr-512-exercise-3/, \"Quadrat counting is useful for characterizing the intensity of an inhomogeneous point process, however there are limitations including: – The choice of origin, quadrat orientation, and quadrat size affects the observed frequency distribution. – A significant amount of spatial data is lost. KDE algorithms use a moving window approach to characterize intensity. This approach tends to preserve a greater amount of spatial detail and does not suffer as much from choices of origin, quadrat orientation, and quadrat size as compared to quadrat counting.\" Conceptually, a smoothly curved surface is fitted over each point. The surface value is highest at the location of the point and diminishes with increasing distance from the point. There will be more about this in the lectures. To apply it in R, we simply use the density command. For example, for the longleaf data, I would create a new code chunk and type. PointDensity &lt;- density(longleaf) plot(PointDensity) # Individual events can be added to the plot by adding our original points to the plot. plot(longleaf, add = TRUE, use.marks = F, cex = 0.5,pch=16) # i&#39;m ignoring the tree diameters and want small filled dots So you can see that instead of quadrats, we now have a smooth surface. In the density command above, the size &amp; shape of the smoothing window, (known as the “bandwidth”) is calculated automatically using a ‘rule of thumb’. It defaults to 0.9 times the minimum of the standard deviation and the interquartile range divided by 1.34 times the sample size to the negative one-fifth power. However, the bandwidth can be scaled via the sigma parameter within the density command: par(mfrow=c(row=1,col=3),mar=c(1,1,1,1)) # set up 3 subplots in a row plot (density(longleaf, sigma = 5, # change bandwidth by altering the value assigned to sigma main=&quot;Bandwidth=5&quot;)) plot(longleaf, add = TRUE,use.marks = F, cex = 0.5,pch=16) plot (density(longleaf, sigma = 20, # change bandwidth by altering the value assigned to sigma main=&quot;Bandwidth=20&quot;)) plot(longleaf, add = TRUE,use.marks = F, cex = 0.5,pch=16) plot (density(longleaf, sigma = 100, # change bandwidth by altering the value assigned to sigma main=&quot;Bandwidth=100&quot;)) plot(longleaf, add = TRUE,use.marks = F, cex = 0.5,pch=16) 3.14 Lab-3 Challenge 6 Create a new sub-heading called Kernel Density Estimation Use the example above to run KDE for the bei data and try modifying the bandwidth using the following numbers: 5, 10, 30, 70, 100, 200. (you just have to edit the bandwidth and discuss the result. YOu do not have to show all 7) Below the code chunk, write what impact modifying the bandwidth has on your results. What happens at very low vs very high bandwidths? 4.What is the “best” bandwidth? Make sure your plot shows your final choice Why did you choose that number? 3.15 Automatically calculating an “optimal” bandwidth Different statisticians have come up with different ways to automatically calculate the “optimal” bandwidth. For example 1. bw.diggle() - minimizes the mean-square error criterion defined by Diggle (1985) 2. bw.frac() - uses a quantile of the distance between two independent random points in the window 3. 3. 3. bw.stoyan() - sets the standard deviation of the kernel You can look at the R help to understand in more detail how they work (e.g. type ?bw.diggle into your console) Here I will apply the diggle() function to estimate a bandwidth for the data # Report the value of the bandwidth optimal_diggle &lt;- bw.diggle(longleaf) # do the density plot plot (density(longleaf, sigma = optimal_diggle), # use the diggle function to automatically guess bandwidth main=paste(&quot;Diggle Bandwidth Estimation = &quot;,round(optimal_diggle,3))) plot(longleaf, add = TRUE,use.marks = F, cex = 0.5,pch=16) 3.16 Lab-3 Challenge 7 Apply the code above to your script to calculate and plot an “optimal” bandwidth for the bei data. Finally, reflect on the lab and look back at the outputs you have made. If someone asks you about the spatial distribution of trees in the area, what would you tell them and which plots and analyses would you use (or not use!) to provide evidence. Write your thoughts below the code chunk. 3.17 Lab-3 Show me something new Make a new sub-heading called Something new. You have three options this week: A - You can show me some minor additions to existing code for 2.5/5 marks. For example: Showing me you know how to do some new markdown format (tables, links - see here for inspiration: https://www.statpower.net/Content/310/R%20Stuff/SampleMarkdown.html) Adding a new minor YAML element (you will have to do this at the top and describe what you did here) Adding contours to the Kernel density data using a command such as contour(density(bei), add=TRUE, col = “white”) Create a 2x2 grid of plots or add a new plotting format. B - For 5/5 you need to demonstrates the use of a function or package that was not specifically covered in the handout, lecture, or lab. For example: Adding a new colour palette from somewhere like R colorbrewer to your Kernel Density plots Adding country or regional borders to these plots Add a paragraph where you explain quadrat and/or kernel density and properly include equations using the R markdown equation format. E.g. they should look like mathematical equations in a text book. Reading/loading in a new point pattern, converting to ppp and running one analysis on it Do something with a completely new package or function Delve into some of the more complexities of the analysis - https://mgimond.github.io/Spatial/point-pattern-analysis.html#local-density Apply one of the other optimal bandwidths to the KDE data e.g. bw.frac or bw.stoyan C - For 5/5, complete an optional extra extension to this work where we use quadrat analysis to assess whether elevation impacts the bei data. Go to this link: https://sites.warnercnr.colostate.edu/wtinkham/courses-taught/nr-512-spatial-statistical-modeling/nr-512-exercise-descriptions/nr-512-exercise-3/ Then scroll down to the end where it says: “In the quadrat counting example above, we used a series of equally sized quadrats to characterize the intensity of a ppp object. In quadrat counting methods, any choice of quadrats is permissible. From a theoretical viewpoint, the quadrats do not have to be rectangles of equal area, instead they could be regions of any shape. Quadrat counting is more useful if we choose the quadrats in a meaningful way. One way to do this is to define the quadrats using covariate information.” Work from that point onward to show how quadrat analysis can be used to link a variable such as elevation to your point pattern. 3.18 Lab-3 submission check HTML FILE SUBMISSION - 5 marks RMD CODE SUBMISSION - 5 marks LAB CHALLENGE 1 to 4 - 10 marks total You included all the requested code/analysis and your code runs for the BEI data (not the longleaf data!) LAB CHALLENGE 5 - 10 marks You thoughtfully explored the impact of changing the quadrat size and shape on the bei data, providing the requested code and outputs. LAB CHALLENGE 6 - 10 marks You chose your best bandwidth for the bei data, showed it on your plot and justified your choice. LAB CHALLENGE 7 - 10 marks You calculated an optimal bandwidth for the data and included a thoughtful, well organized, and articulated response to your reflections on the lab. SOMETHING NEW - 5 marks You made a minor change to an existing piece of code (2.5/5) OR You demonstrated the use of a function or concept that was not specifically covered in the handout, lecture, or lab (5/5) MARKDOWN/CODE STYLE - 5 MARKS Your code and document is neat and easy to read. You have section headings, have clearly labeled your answers or described what you are trying to do in the code. [60 marks total] THERE IS A CANVAS QUIZ WITH THIS LAB FOR THE OTHER 40 MARKS "]
]
